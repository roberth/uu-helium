-------------------------------------------------------------------------------
--
--   *** The Helium Compiler : Static Analysis ***
--               ( Bastiaan Heeren )
--
-- TypeInferencing.ag : The type inferencer for Helium
--
-------------------------------------------------------------------------------

ATTR Module
   [ importEnvironment     : ImportEnvironment
     options               : {[Option]}
   |
   | debugIO               : {IO ()}
     localTypes            : LocalTypes
     overloadedVars        : OverloadedVariables
     toplevelTypes         : TypeEnvironment
     typeErrors            : TypeErrors
     warnings              : Warnings
   ]

INCLUDE "TypeInferenceRules.ag"
INCLUDE "TypeInferenceInfo.ag"
INCLUDE "PatternMatchWarnings.ag"
INCLUDE "../staticchecks/HeliumPartialSyntax.ag"
INCLUDE "../../syntax/UHA_OneLine.ag"
INCLUDE "../../syntax/UHA_Syntax.ag"
INCLUDE "../staticchecks/Scope.ag" 

SEM Module
  | Module lhs . warnings = @loc.warnings ++ @body.patternMatchWarnings

imports {

-- standard
import Monad                   ( when )
import List                    ( intersperse, partition, nub, zipWith4, union )
import Maybe (catMaybes, mapMaybe)
import Args
-- types
import Types
import TypeConversion
-- constraints
import TypeConstraints
import LiftedConstraints
import TreeWalk
import Tree
-- messages
import Messages
import TypeErrors
import Warnings
-- solvers
import SolveTypeGraph
import TypeGraphInstance
import SolveGreedy           
import ConstraintInfo
import TypeGraphConstraintInfo
import HeliumConstraintInfo
import Constraints
import TypeConstraintSemantics
import SolveState
import IsSolver
import SimilarFunctionTable    ( similarFunctionTable )
-- other
import TopSort                 ( topSort )
import Utils                   ( internalError )
import DerivingShow            ( typeOfShowFunction, nameOfShowFunction ) 
import UHA_Range               ( noRange, getNameRange, getExprRange, getPatRange, getLitRange, setNameRange )
import UHA_Syntax
import UHA_Utils               ( showNameAsOperator, intUnaryMinusName )
import ImportEnvironment
import Data.FiniteMap
}

--- The following lines enable Type Strategies. 

INCLUDE "typingstrategies/TS_PatternMatching.ag"

SEM Module
  | Module  lhs . debugIO = @debugIO >> putStrLn "Inference Strategies:" >> @body.matchIO
