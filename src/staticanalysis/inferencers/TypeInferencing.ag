-------------------------------------------------------------------------------
--
--   *** The Helium Compiler : Static Analysis ***
--               ( Bastiaan Heeren )
--
-- TypeInferencing.ag : The type inferencer for Helium
--
-------------------------------------------------------------------------------

ATTR Module
   [ importEnvironment     : ImportEnvironment
     strategy              : Strategy
     useTypeGraph          : Bool
   |
   | debugIO               : {IO ()}
     toplevelTypes         : TypeEnvironment
     typeErrors            : TypeErrors
     warnings              : Warnings
   ]

INCLUDE "TypeInferenceRules.ag"
INCLUDE "TypeInferenceInfo.ag"
INCLUDE "PatternMatchWarnings.ag"
INCLUDE "../staticchecks/HeliumPartialSyntax.ag"
INCLUDE "../../syntax/UHA_OneLine.ag"
INCLUDE "../../syntax/UHA_Syntax.ag"

SEM Module
  | Module lhs . warnings = @loc.warnings ++ @body.patternMatchWarnings

imports {

-- standard
import Monad                   ( when )
import List                    ( intersperse, partition, nub, zipWith4, union )
-- types
import Types
import TypeConversion
-- constraints
import TypeConstraints
import LiftedConstraints
import ConstraintTree
import Strategy
-- messages
import Messages
import TypeErrors
import Warnings
-- solvers
import SolveTypeGraph
import TypeGraphInstance
import SolveGreedy           
import ConstraintInfo
import TypeGraphConstraintInfo
import HeliumConstraintInfo
import SolverOptions
import Constraints
import TypeConstraintSemantics
import SolveState
-- other
import TopSort                 ( topSort )
import Utils                   ( internalError )
import DerivingShow            ( typeOfShowFunction, nameOfShowFunction ) 
import UHA_Range               ( noRange, getNameRange, getExprRange, getPatRange, getLitRange )
import UHA_Syntax
import UHA_Utils               ( showNameAsOperator )
import ImportEnvironment
import FiniteMap
}

--- The following lines enable Type Strategies. 

INCLUDE "typingstrategies/TS_PatternMatching.ag"

SEM Module
  | Module  lhs . debugIO = @debugIO >> putStrLn "Inference Strategies:" >> @body.matchIO
